<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foro Experiencias Usuarios - MindTea</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Header y Navegaci√≥n -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="logo">
                    <img src="logo.png" alt="MindTea Logo" class="logo-img">
                    <span class="logo-text">MindTea</span>
                </div>
                <ul class="nav-menu" id="nav-menu">
                    <li class="nav-item">
                        <a href="index.html" class="nav-link">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a href="index.html#proposito" class="nav-link">Prop√≥sito</a>
                    </li>
                    <li class="nav-item">
                        <a href="index.html#recursos" class="nav-link">Recursos</a>
                    </li>
                    <li class="nav-item">
                        <a href="index.html#contacto" class="nav-link">Contacto</a>
                    </li>
                </ul>
                <div class="hamburger" id="hamburger">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Secci√≥n Foro -->
    <section class="recursos-detalle">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html#recursos" class="breadcrumb-link">
                    <i class="fas fa-arrow-left"></i> Volver a Recursos
                </a>
            </div>
            
            <div class="foro-header">
                <div class="foro-icon">
                    <span class="emoji-icon">üí¨</span>
                </div>
                <h1 class="section-title">Foro de Experiencias Usuarios</h1>
                <p class="foro-description">Comparte y lee experiencias reales de familias y profesionales sobre el TEA</p>
            </div>

            <!-- Bot√≥n para publicar nueva experiencia -->
            <div class="publicar-experiencia">
                <button id="btn-publicar" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    Publicar Nueva Experiencia
                </button>
            </div>

            <!-- Listado de experiencias -->
            <div class="experiencias-container">
                <h2 class="experiencias-title">Experiencias Recientes</h2>
                <div id="lista-experiencias" class="lista-experiencias">
                    <!-- Las experiencias se cargar√°n din√°micamente aqu√≠ -->
                    <div class="experiencia-vacia">
                        <p>No hay experiencias publicadas a√∫n. ¬°S√© el primero en compartir tu historia!</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal para publicar experiencia -->
    <div id="modal-experiencia" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Compartir Experiencia</h2>
                <span class="close">&times;</span>
            </div>
            <form id="form-experiencia" class="form-experiencia">
                <div class="form-group">
                    <label for="titulo">T√≠tulo de la experiencia</label>
                    <input type="text" id="titulo" name="titulo" placeholder="Ej: Mi experiencia con la terapia ocupacional" required>
                </div>
                <div class="form-group">
                    <label for="categoria">Categor√≠a</label>
                    <select id="categoria" name="categoria" required>
                        <option value="">Selecciona una categor√≠a</option>
                        <option value="diagnostico">Diagn√≥stico</option>
                        <option value="terapias">Terapias</option>
                        <option value="educacion">Educaci√≥n</option>
                        <option value="vida-cotidiana">Vida Cotidiana</option>
                        <option value="derechos">Derechos y Leyes</option>
                        <option value="otro">Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="experiencia">Tu experiencia</label>
                    <textarea id="experiencia" name="experiencia" placeholder="Comparte tu historia, consejos, aprendizajes..." rows="8" required></textarea>
                </div>
                <div class="form-group">
                    <label for="nombre">Tu nombre (opcional)</label>
                    <input type="text" id="nombre" name="nombre" placeholder="Puede ser an√≥nimo">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="btn-cancelar">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Publicar Experiencia</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="logo.png" alt="MindTea Logo" class="footer-logo-img">
                    <span class="footer-logo-text">MindTea</span>
                </div>
                <p class="footer-motto">Conectando Familias con Profesionales</p>
                <div class="footer-social">
                    <a href="https://whatsapp.com/channel/0029Vb6fP7U2kNFi41gnhb1B" target="_blank" rel="noopener noreferrer" class="social-link">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://www.linkedin.com/company/mindtea/about/?viewAsMember=true" target="_blank" rel="noopener noreferrer" class="social-link">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.instagram.com/mindteacl?igsh=emthZnl0cnEya2Zu" target="_blank" rel="noopener noreferrer" class="social-link">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="mailto:contacto@mindtea.cl" class="social-link">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 MindTea. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="foro-db.js"></script>
    <script>
        // Funcionalidad del foro con base de datos
        document.addEventListener('DOMContentLoaded', async function() {
            const modal = document.getElementById('modal-experiencia');
            const btnPublicar = document.getElementById('btn-publicar');
            const btnCancelar = document.getElementById('btn-cancelar');
            const closeBtn = document.querySelector('.close');
            const formExperiencia = document.getElementById('form-experiencia');
            const listaExperiencias = document.getElementById('lista-experiencias');

            // Cargar experiencias existentes desde la base de datos
            await cargarExperiencias();

            // Abrir modal
            btnPublicar.addEventListener('click', function() {
                modal.style.display = 'block';
            });

            // Cerrar modal
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });

            btnCancelar.addEventListener('click', function() {
                modal.style.display = 'none';
            });

            // Cerrar modal al hacer clic fuera
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // Enviar formulario
            formExperiencia.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const titulo = document.getElementById('titulo').value;
                const categoria = document.getElementById('categoria').value;
                const experiencia = document.getElementById('experiencia').value;
                const nombre = document.getElementById('nombre').value || 'An√≥nimo';

                // Extraer hashtags del texto
                const hashtags = extraerHashtags(experiencia);

                // Crear nueva publicaci√≥n
                const nuevaPublicacion = {
                    titulo: titulo,
                    categoria: categoria,
                    contenido: experiencia,
                    autor: nombre,
                    hashtags: hashtags
                };

                try {
                    // Guardar en la base de datos
                    const resultado = await foroDB.crearPublicacion(nuevaPublicacion);
                    
                    if (resultado) {
                        // Actualizar lista
                        await cargarExperiencias();

                        // Limpiar formulario y cerrar modal
                        formExperiencia.reset();
                        modal.style.display = 'none';

                        // Mostrar mensaje de √©xito
                        alert('¬°Tu experiencia ha sido publicada exitosamente!');
                    } else {
                        alert('Error al publicar la experiencia. Int√©ntalo de nuevo.');
                    }
                } catch (error) {
                    console.error('Error al publicar:', error);
                    alert('Error al publicar la experiencia. Int√©ntalo de nuevo.');
                }
            });

            async function cargarExperiencias() {
                try {
                    const publicaciones = await foroDB.obtenerPublicaciones();
                    
                    // Verificar que hay publicaciones para mostrar
                    if (publicaciones.length === 0) {
                        listaExperiencias.innerHTML = `
                            <div class="experiencia-vacia">
                                <p>No hay experiencias publicadas a√∫n. ¬°S√© el primero en compartir tu historia!</p>
                            </div>
                        `;
                        return;
                    }

                    // Ordenar por fecha (m√°s recientes primero)
                    publicaciones.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

                    listaExperiencias.innerHTML = publicaciones.map(publicacion => `
                        <div class="experiencia-item" data-id="${publicacion.id}">
                            <div class="experiencia-header">
                                <h3 class="experiencia-titulo">${publicacion.titulo}</h3>
                                <span class="experiencia-fecha">${formatearFecha(publicacion.fecha)}</span>
                            </div>
                            <div class="experiencia-categoria">
                                <span class="categoria-badge">${obtenerNombreCategoria(publicacion.categoria)}</span>
                            </div>
                            <div class="experiencia-contenido">
                                <p>${publicacion.contenido}</p>
                            </div>
                            ${publicacion.hashtags && publicacion.hashtags.length > 0 ? `
                            <div class="hashtags-container">
                                ${publicacion.hashtags.map(tag => `
                                    <span class="hashtag">${tag}</span>
                                `).join('')}
                            </div>
                            ` : ''}
                            <div class="experiencia-footer">
                                <div class="experiencia-autor">
                                    <i class="fas fa-user"></i>
                                    <span>${publicacion.autor}</span>
                                </div>
                                <div class="experiencia-acciones">
                                    <button class="btn-like" onclick="darLike(${publicacion.id})">
                                        <i class="fas fa-heart"></i>
                                        <span>${publicacion.likes || 0}</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Error al cargar experiencias:', error);
                    listaExperiencias.innerHTML = `
                        <div class="experiencia-vacia">
                            <p>Error al cargar las experiencias. Int√©ntalo de nuevo m√°s tarde.</p>
                        </div>
                    `;
                }
            }
        });
    </script>
</body>
</html>
